# Capybara

## Setting up the Environment

Follow [this guide](https://everythingtech.dev/2023/06/step-by-step-guide-on-how-to-get-started-with-drogon-on-windows-with-visual-studio/) to set up the environment. A few things that differs from the tutorial:
* Step 2.7: Along with the tutorial. Run these commands:
  ```
  vcpkg install nlohmann-json
  vcpkg install sqlite3
  ```
* Step 3.2: Don't follow the tutorial. Instead:
  * Create a **CMake** C++ project with VS. Call the project Capybara.
  * Copy the `.gitignore` file on GitHub to the root directory, exactly placed as shown on the repo. We will hard pull the code on the repo, but we want to keep the config files generated by VS, so we need this to let git untrack them.
  * In terminal, go to project root directory:
  ```
  git init
  git status //make sure .vs/ and out/ does not appear
  git remote add origin https://github.com/mm6234/Capybara.git
  git remote -v
  // origin  https://github.com/mm6234/Capybara.git (fetch)
  // origin  https://github.com/mm6234/Capybara.git (push)
  git fetch --all
  git reset --hard origin/main
  ```
* Step 3.4: Change the file named `CMakePresets.json` at the root directory. Change `toolchainFile`'s directory to `vcpkg.cmake` (see appendix below). Use two slashes `\\`. 
* Step 3.5 and 3.6: Do not need to modify; the change should be reflected in the repo. 
* If you encounter issues in step 2.7, try uninstall `cmake` and try again. 

After the tutorial, compile the code and start the exe file. Use tools such as **postman** or **curl** to test the program. 

## API Documentation

### Retrieve the Doctor's Info Based on the Doctor's ID

```
GET http://capybara.com/api/doctor-info/{DoctorId}
```

**Example Return Body (Includes All Possible Fields):**
```
{
  "id": 3,
  "doctorName": "Capybara",
  "rating": 3.5,
  "submissions": 1834,
  "location": {
    "latitude": 3.222,
    "longitude": 78.43
  },
  "practiceKeywords": [
    "Ear",
    "Nose",
    "Throat"
  ],
  "languagesSpoken": [
    "English"
  ],
  "Insurance": [
    "Aetna"
  ],
  "Other": {
    "streetAddress": "NYC"
  }
}
```

If the doctor `id` cannot be coverted to an integer or it does not exist, a _400 bad request_ is returned.

```
{"error": "Illegal 'id' field!"}
```

### Create/Update Doctor Information

```
POST http://capybara.com/api/update
```

If `id` is not included, we create a new doctor record and return the id.

**Example Request Body to Create a Doctor Record:**
```
{
  "fieldToUpdate": "doctorName",
  "fieldValue": "Capybara Elite"
} 
```

**Example Return Body to Create a Doctor Record:**
```
{
    "id": 1
}
```
If `id` is included, then the existing doctor record is updated.

**Example Request Body to Update Doctor Record:**
```
{
  "id": 3,
  "fieldToUpdate": "doctorName",
  "fieldValue": "Capybara Elite"
} 
```

If the Json format is invalid, a _400 bad request_ is returned.
Request Json:
```
{
  "id": 3,
  "fieldToUpdate": "doctorName"
}
```
Return body:
```
{
    "error": "Invalid JSON format in the request body"
}
```
__IMPORTANT:__ `id` is an integer and should never have double quotes.
`fieldValue` should always have double quotes, even if the field is a number.

### Retrieve & Order Doctor Suggestions

**Example: Sort by Rating**

```
GET http://127.0.0.1:6969/api/query/Yes/No

# GET http://127.0.0.1:6969/api/query/Yes/Yes will also output a sorted list by ranking. The first 'Yes' is the only one considered by design.
```

This will output doctors stored in the database in the order of highest to lowest rating.

**Example: Sort by Number of Supplied User Rankings**

```
GET http://127.0.0.1:6969/api/query/No/Yes
```

This will output doctors stored in the database in the order of highest to lowest number of user-supplied rankings.

**Example: Sort by Location**

```
GET http://127.0.0.1:6969/api/query/No/No/100.1_100.3
```

This will output doctors stored in the database in the order of closest to furthest distance from the user's supplied location.

## Unit test
We use Google Test; in Visual Studio, simply "start debugging" on `Unittest.cpp`.

## Acknowledgement
* `.gitignore` file template from github's [gitignore repo](https://github.com/github/gitignore/blob/main/VisualStudio.gitignore). Used for best practices. 

## Appendix
`CMakePresets.json`: Change `toolchainFile` to the approptiate directory. For example: `"C:\\Users\\iamyo\\projects\\vcpkg\\scripts\\buildsystems\\vcpkg.cmake"`
```
{
    "version": 3,
    "configurePresets": [
        {
            "name": "windows-base",
            "hidden": true,
            "generator": "Ninja",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "installDir": "${sourceDir}/out/install/${presetName}",
            "cacheVariables": {
                "CMAKE_C_COMPILER": "cl.exe",
                "CMAKE_CXX_COMPILER": "cl.exe"
            },
            "condition": {
                "type": "equals",
                "lhs": "${hostSystemName}",
                "rhs": "Windows"
            }
        },
      {
        "name": "x64-debug",
        "displayName": "x64 Debug",
        "inherits": "windows-base",
        "architecture": {
          "value": "x64",
          "strategy": "external"
        },
        "cacheVariables": {
          "CMAKE_BUILD_TYPE": "Debug"
        },
        "toolchainFile": "<Insert your directory to vcpkg.cmake>"
      },
        {
            "name": "x64-release",
            "displayName": "x64 Release",
            "inherits": "x64-debug",
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Release"
            }
        },
        {
            "name": "x86-debug",
            "displayName": "x86 Debug",
            "inherits": "windows-base",
            "architecture": {
                "value": "x86",
                "strategy": "external"
            },
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Debug"
            }
        },
        {
            "name": "x86-release",
            "displayName": "x86 Release",
            "inherits": "x86-debug",
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Release"
            }
        },
        {
            "name": "linux-debug",
            "displayName": "Linux Debug",
            "generator": "Ninja",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "installDir": "${sourceDir}/out/install/${presetName}",
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Debug"
            },
            "condition": {
                "type": "equals",
                "lhs": "${hostSystemName}",
                "rhs": "Linux"
            },
            "vendor": {
                "microsoft.com/VisualStudioRemoteSettings/CMake/1.0": {
                    "sourceDir": "$env{HOME}/.vs/$ms{projectDirName}"
                }
            }
        },
        {
            "name": "macos-debug",
            "displayName": "macOS Debug",
            "generator": "Ninja",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "installDir": "${sourceDir}/out/install/${presetName}",
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Debug"
            },
            "condition": {
                "type": "equals",
                "lhs": "${hostSystemName}",
                "rhs": "Darwin"
            },
            "vendor": {
                "microsoft.com/VisualStudioRemoteSettings/CMake/1.0": {
                    "sourceDir": "$env{HOME}/.vs/$ms{projectDirName}"
                }
            }
        }
    ]
}

```
